# Guide de Configuration Supabase - BlueKit Stack Builder

Ce guide vous accompagne √©tape par √©tape pour configurer Supabase en production pour BlueKit.

## üìã Pr√©requis

- Compte GitHub (pour OAuth)
- Compte Google Cloud (pour OAuth Google)
- Acc√®s √† votre domaine (pour les redirections)
- Terminal avec acc√®s Internet

## üöÄ √âtape 1 : Cr√©er le Projet Supabase

### 1.1 Inscription et Cr√©ation du Projet

1. **Aller sur [supabase.com](https://supabase.com)**
2. **Cliquer sur "Start your project"**
3. **Se connecter avec GitHub** (recommand√©)
4. **Cr√©er une nouvelle organisation** (si premi√®re fois)
   - Nom : `BlueKit` ou votre nom d'organisation
5. **Cr√©er un nouveau projet**
   - Nom du projet : `bluekit-stack-builder`
   - Mot de passe de la base de donn√©es : **G√©n√©rer un mot de passe fort et le sauvegarder**
   - R√©gion : Choisir la plus proche de vos utilisateurs
   - Plan : Gratuit pour commencer

### 1.2 Attendre la Cr√©ation du Projet

‚è±Ô∏è **Temps d'attente** : 2-3 minutes pour que le projet soit pr√™t.

## üîë √âtape 2 : R√©cup√©rer les Cl√©s API

### 2.1 Acc√©der aux Settings

1. **Dans votre projet Supabase, aller dans l'onglet "Settings"**
2. **Cliquer sur "API" dans le menu de gauche**

### 2.2 Noter les Informations Importantes

```bash
# Copier ces valeurs dans un fichier temporaire
Project URL: https://[votre-project-ref].supabase.co
Anon key: eyJ... (tr√®s longue cl√©)
Service role key: eyJ... (tr√®s longue cl√©, CONFIDENTIELLE)
```

‚ö†Ô∏è **IMPORTANT** : La `service role key` doit rester confidentielle !

## üóÑÔ∏è √âtape 3 : Configurer la Base de Donn√©es

### 3.1 Installer le CLI Supabase

```bash
# Sur macOS (avec Homebrew)
brew install supabase/tap/supabase

# Sur Windows (avec Scoop)
scoop bucket add supabase https://github.com/supabase/scoop-bucket.git
scoop install supabase

# Sur Linux ou avec npm
npm install -g supabase
```

### 3.2 Se Connecter au Projet

```bash
# Dans le dossier de votre projet BlueKit
cd /chemin/vers/BlueKit.io

# Se connecter √† Supabase
supabase login

# Lier le projet local au projet distant
supabase link --project-ref [votre-project-ref]
```

### 3.3 Migrer le Sch√©ma de Base

```bash
# Appliquer les migrations
supabase db push

# Si erreur, utiliser la migration manuelle :
# Copier le contenu de supabase/migrations/01_initial_schema.sql
# Et l'ex√©cuter dans l'√©diteur SQL de Supabase
```

### 3.4 Ajouter les Donn√©es de Base

1. **Aller dans l'√©diteur SQL de Supabase**
2. **Copier le contenu de `supabase/seed.sql`**
3. **Ex√©cuter le script**

```sql
-- V√©rifier que les tables sont cr√©√©es
SELECT table_name FROM information_schema.tables 
WHERE table_schema = 'public';

-- V√©rifier les donn√©es de base
SELECT COUNT(*) FROM technologies;
```

## üõ°Ô∏è √âtape 4 : Configurer l'Authentification

### 4.1 Param√®tres G√©n√©raux

1. **Aller dans Authentication > Settings**
2. **Configurer les param√®tres** :
   - ‚úÖ Enable email confirmations
   - ‚úÖ Enable email change confirmations
   - Site URL : `http://localhost:3000` (d√©veloppement)
   - Site URL : `https://votre-domaine.com` (production)

### 4.2 URLs de Redirection

**Ajouter les URLs autoris√©es** :

```
# D√©veloppement
http://localhost:3000/auth/callback

# Production
https://votre-domaine.com/auth/callback
https://www.votre-domaine.com/auth/callback
```

### 4.3 Configurer GitHub OAuth

1. **Aller sur [GitHub Developer Settings](https://github.com/settings/developers)**
2. **Cr√©er une nouvelle OAuth App** :
   - Application name : `BlueKit Stack Builder`
   - Homepage URL : `https://votre-domaine.com`
   - Authorization callback URL : `https://[votre-project-ref].supabase.co/auth/v1/callback`

3. **Noter les informations** :
   - Client ID
   - Client Secret

4. **Dans Supabase Authentication > Providers** :
   - Activer GitHub
   - Ajouter Client ID et Client Secret

### 4.4 Configurer Google OAuth

1. **Aller sur [Google Cloud Console](https://console.cloud.google.com)**
2. **Cr√©er un nouveau projet** ou s√©lectionner un existant
3. **Activer Google+ API** :
   - APIs & Services > Library
   - Rechercher "Google+ API"
   - Activer

4. **Cr√©er les identifiants OAuth** :
   - APIs & Services > Credentials
   - Create Credentials > OAuth 2.0 Client IDs
   - Type : Web application
   - Authorized redirect URIs : `https://[votre-project-ref].supabase.co/auth/v1/callback`

5. **Dans Supabase Authentication > Providers** :
   - Activer Google
   - Ajouter Client ID et Client Secret

## üîß √âtape 5 : Configuration de l'Application

### 5.1 Variables d'Environnement

**Cr√©er/Modifier `.env.local`** :

```bash
# Remplacer par vos vraies valeurs
NEXT_PUBLIC_SUPABASE_URL=https://[votre-project-ref].supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJ... (votre anon key)
SUPABASE_SERVICE_ROLE_KEY=eyJ... (votre service role key)

NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=votre-secret-aleatoire-tres-long
```

### 5.2 G√©n√©rer un Secret NextAuth

```bash
# G√©n√©rer un secret al√©atoire
openssl rand -base64 32

# Ou utiliser
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
```

### 5.3 Mise √† Jour pour la Production

**Pour d√©ployer sur Vercel/Netlify**, modifier les variables :

```bash
NEXT_PUBLIC_SUPABASE_URL=https://[votre-project-ref].supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJ...
SUPABASE_SERVICE_ROLE_KEY=eyJ...
NEXTAUTH_URL=https://votre-domaine.com
NEXTAUTH_SECRET=votre-secret-production
```

## üß™ √âtape 6 : Tests et V√©rification

### 6.1 Tester l'Application Localement

```bash
# Installer les d√©pendances
npm install

# Lancer l'application
npm run dev

# Ouvrir http://localhost:3000
```

### 6.2 Tester l'Authentification

1. **Aller sur `/auth/signup`**
2. **Cr√©er un compte avec email/password**
3. **V√©rifier l'email de confirmation**
4. **Se connecter avec `/auth/login`**
5. **Tester OAuth avec GitHub et Google**

### 6.3 V√©rifier la Base de Donn√©es

```sql
-- Dans l'√©diteur SQL Supabase
SELECT * FROM auth.users LIMIT 5;
SELECT * FROM public.users LIMIT 5;
SELECT * FROM public.technologies LIMIT 10;
```

## üìß √âtape 7 : Configuration des Emails

### 7.1 Templates d'Emails

1. **Aller dans Authentication > Email Templates**
2. **Personnaliser les templates** :
   - Confirm signup
   - Magic Link
   - Change Email Address
   - Reset Password

### 7.2 Exemple de Template

```html
<h2>Bienvenue sur BlueKit !</h2>
<p>Cliquez sur le lien ci-dessous pour confirmer votre email :</p>
<p><a href="{{ .ConfirmationURL }}">Confirmer mon email</a></p>
<p>Si vous n'avez pas cr√©√© de compte, ignorez cet email.</p>
<p>L'√©quipe BlueKit</p>
```

## üõ°Ô∏è √âtape 8 : S√©curit√© et Politiques RLS

### 8.1 V√©rifier les Politiques RLS

```sql
-- V√©rifier que RLS est activ√©
SELECT schemaname, tablename, rowsecurity 
FROM pg_tables 
WHERE schemaname = 'public';

-- Lister les politiques
SELECT * FROM pg_policies WHERE schemaname = 'public';
```

### 8.2 Tester les Permissions

1. **Se connecter avec un utilisateur**
2. **Essayer de cr√©er une stack**
3. **V√©rifier qu'on ne peut modifier que ses propres donn√©es**

## üöÄ √âtape 9 : D√©ploiement en Production

### 9.1 Configuration Vercel

```bash
# Installer Vercel CLI
npm i -g vercel

# Se connecter
vercel login

# Configurer les variables d'environnement
vercel env add NEXT_PUBLIC_SUPABASE_URL
vercel env add NEXT_PUBLIC_SUPABASE_ANON_KEY
vercel env add SUPABASE_SERVICE_ROLE_KEY
vercel env add NEXTAUTH_URL
vercel env add NEXTAUTH_SECRET

# D√©ployer
vercel --prod
```

### 9.2 Mettre √† Jour les URLs Supabase

1. **Dans Supabase Authentication > Settings**
2. **Ajouter l'URL de production** :
   - Site URL : `https://votre-domaine-vercel.vercel.app`
   - Redirect URLs : `https://votre-domaine-vercel.vercel.app/auth/callback`

## ‚úÖ √âtape 10 : V√©rification Finale

### 10.1 Checklist de V√©rification

- [ ] ‚úÖ Projet Supabase cr√©√© et fonctionnel
- [ ] ‚úÖ Base de donn√©es migr√©e avec toutes les tables
- [ ] ‚úÖ Donn√©es de base (technologies) ins√©r√©es
- [ ] ‚úÖ Authentification email/password fonctionne
- [ ] ‚úÖ OAuth GitHub configur√© et test√©
- [ ] ‚úÖ OAuth Google configur√© et test√©
- [ ] ‚úÖ Politiques RLS actives et test√©es
- [ ] ‚úÖ Variables d'environnement configur√©es
- [ ] ‚úÖ Application d√©ploy√©e en production
- [ ] ‚úÖ Emails de confirmation fonctionnels

### 10.2 Tests Finaux

```bash
# Tester les API routes
curl https://votre-domaine.com/api/health

# Tester l'authentification
# Se connecter sur https://votre-domaine.com/auth/login

# V√©rifier les logs Supabase
# Aller dans Logs > Auth dans le dashboard Supabase
```

## üÜò D√©pannage Courant

### Erreur : "Invalid login credentials"
```bash
# V√©rifier dans Supabase Dashboard > Authentication > Users
# L'utilisateur existe-t-il ?
# L'email a-t-il √©t√© confirm√© ?
```

### Erreur : "Failed to fetch user"
```bash
# V√©rifier les variables d'environnement
echo $NEXT_PUBLIC_SUPABASE_URL
echo $NEXT_PUBLIC_SUPABASE_ANON_KEY

# V√©rifier la connexion r√©seau
curl https://[votre-project-ref].supabase.co/rest/v1/
```

### OAuth ne fonctionne pas
```bash
# V√©rifier les URLs de callback dans :
# 1. Provider OAuth (GitHub/Google)
# 2. Supabase Authentication settings
# 3. Variables d'environnement NEXTAUTH_URL
```

### Probl√®mes de permissions
```sql
-- V√©rifier les politiques RLS
SELECT * FROM pg_policies WHERE schemaname = 'public';

-- Tester une requ√™te manuellement
SELECT * FROM public.users WHERE id = auth.uid();
```

## üìö Ressources Suppl√©mentaires

- [Documentation Supabase](https://supabase.com/docs)
- [Guide d'authentification Next.js](https://supabase.com/docs/guides/auth/auth-helpers/nextjs)
- [Configuration OAuth](https://supabase.com/docs/guides/auth/social-login)
- [Row Level Security](https://supabase.com/docs/guides/auth/row-level-security)

## üéØ Prochaines √âtapes

Une fois Supabase configur√© :

1. **Optimiser les performances** de l'application
2. **Impl√©menter les fonctionnalit√©s d'export**
3. **Ajouter le syst√®me de reviews**
4. **D√©velopper le mode collaboration**

---

**üöÄ F√©licitations ! Votre instance Supabase est maintenant pr√™te pour BlueKit Stack Builder !**